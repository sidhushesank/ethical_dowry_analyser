{% extends 'base.html' %}
{% block title %}Dowry Hotspots{% endblock %}

{% block content %}
<h1>Dowry Hotspots by Region</h1>
<div id="map" style="height: 600px; border-radius: 12px; margin-top: 1.2rem;"></div>
<div id="legend" style="background:white; padding:10px; border-radius:6px; position:absolute; bottom:30px; left:10px; z-index:1000; font-family:sans-serif; font-size:14px;">
  <h4>Case Severity</h4>
  <i style="background:#FF0000; width:18px; height:18px; display:inline-block; margin-right:5px;"></i> Very High (More cases)<br>
  <i style="background:#FF7F50; width:18px; height:18px; display:inline-block; margin-right:5px;"></i> High<br>
  <i style="background:#FFD700; width:18px; height:18px; display:inline-block; margin-right:5px;"></i> Moderate<br>
  <i style="background:#90EE90; width:18px; height:18px; display:inline-block; margin-right:5px;"></i> Low (Fewer cases)<br>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function() {
  var map = L.map('map').setView([20.5937, 78.9629], 5);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);

  var hotspots = {{ hotspots_json|tojson }};
  
  // Function to determine color based on cases
  function getColor(cases) {
    return cases > 10 ? '#FF0000' :     // Red for very high
           cases > 7  ? '#FF7F50' :     // Coral for high
           cases > 4  ? '#FFD700' :     // Gold for moderate
                        '#90EE90';      // LightGreen for low
  }

  hotspots.forEach(function(loc) {
    L.circle([loc.lat, loc.lon], {
      color: getColor(loc.cases),
      fillColor: getColor(loc.cases),
      fillOpacity: 0.6,
      radius: loc.cases * 4000
    }).addTo(map).bindPopup(
      `<b>Region:</b> ${loc.region}<br><b>Cases:</b> ${loc.cases}`
    );
  });
});
</script>
{% endblock %}
